 - Amaç: Kamyonlar için web tabanlı, Almanya odaklı,             │
 │    palet/tonaj kontrollü, çok duraklı rota planlama ve             │
 │    yönetim sistemi.                                                │
 │    - Proje Adı: MyTouren (Navi3).                                  │
 │                                                                    │
 │    Sistem Mimarisi ve Temel Bileşenler:                            │
 │    - Frontend: HTML, CSS, JavaScript.                              │
 │      - Kütüphaneler: Bootstrap 5, Split.js, Sortable.js,           │
 │    Flatpickr, Firebase Client SDK.                                 │
 │      - Ana Görünümler: Giriş/Kayıt, Rota Oluşturma (Market         │
 │    Seçimi, Palet Girişi, Rota Detayları), Şoför Yönetimi,          │
 │    Market Yönetimi, Tur Arşivi, Ayarlar.                           │
 │    - Backend: Node.js/Express.js.                                  │
 │      - API Endpoints: /api/auth, /api/drivers,                     │
 │    /api/markets, /api/custom-fields, /api/routing,                 │
 │    /api/seed.                                                      │
 │    - Veritabanı: Firestore (Firebase).                             │
 │    - Harita/Rota Servisi: HERE API (Routing v8,                    │
 │    Geocoding).                                                     │
 │                                                                    │
 │    Yapılan Geliştirmeler ve Mevcut Durum:                          │
 │    1. HERE API Entegrasyonu ve Optimizasyonu:                      │
 │       - Eski HERE Fleet Telematics API yerine güncel HERE          │
 │    Waypoint Sequence API v8 kullanımı.                             │
 │       - /api/optimize-route endpoint'inin POST'tan GET'e           │
 │    çevrilmesi ve viaPoints parametresinin doğru                    │
 │    ayrıştırılması.                                                 │
 │       - js/app.js'deki marketEditorMap.get='screenToGeo'           │
 │    yazım hatasının düzeltilmesi.                                   │
 │       - HERE Geocoding API countryCode parametresinin              │
 │    DE'den DEU'ya çevrilmesi.                                       │
 │    2. Market Yönetimi İyileştirmeleri:                             │
 │       - Market düzenleyiciye HERE Haritası entegrasyonu            │
 │    (arama kutusu, harita üzerinde konum seçimi, işaretçi           │
 │    yönetimi).                                                      │
 │       - Adres alanlarının readonly yapılması ve haritadan          │
 │    otomatik doldurulması.                                          │
 │       - "Seçilen Marketi Ekle" butonunun eklenmesi ve              │
 │    işlevselliği.                                                   │
 │       - Yeni market eklendiğinde/güncellendiğinde şehrin           │
 │    Firestore cities koleksiyonuna otomatik eklenmesi.              │
 │       - Şehir arama önerilerinin hem market yönetiminde            │
 │    hem de rota oluşturma bölümünde anlık olarak                    │
 │    güncellenmesi ve çalışması.                                     │
 │       - Market adı alanının HERE API sonucundan otomatik           │
 │    doldurulması.                                                   │
 │       - Yeni: Excel'den market yükleme özelliği eklendi            │
 │    (/api/markets/upload-excel endpoint'i ve frontend               │
 │    entegrasyonu). .xls ve .xlsx formatlarını destekler.            │
 │    Başlıklar: market ismi, müşteri ismi (veya müşteri              │
 │    numarası), adres.                                               │
 │       - Yeni: Market Yönetimi sayfasında "Mevcut                   │
 │    Marketler" listesi başlangıçta boş bırakıldı, sadece            │
 │    arama yapıldığında dolacak. "Son Eklenen 10 Market"             │
 │    bölümü eklendi ve en son eklenen marketler burada               │
 │    listeleniyor.                                                   │
 │       - Yeni: "Mevcut Marketler" listesindeki kutucukların         │
 │    arka plan rengi gri (#e9ecef) olarak ayarlandı, "Son            │
 │    Eklenen 10 Market" listesi beyaz kaldı.                         │
 │    3. Şoför Yönetimi: Şoför ekleme, listeleme, silme,              │
 │    düzenleme.                                                      │
 │       - Düzeltme: Şoför seçim dropdown'ında ismin yanında          │
 │    "undefined" görünmesi sorunu, driver.plate yerine               │
 │    driver.licensePlate kullanılarak giderildi.                     │
 │    4. Rota Oluşturma ve Yönetimi:                                  │
 │       - Başlangıç/Bitiş noktaları ve kamyon tonajı                 │
 │    girişleri mevcut.                                               │
 │       - Seçilen marketler üzerinden rota optimizasyonu             │
 │    yapılıyor ve haritada çiziliyor.                                │
 │       - Kaydedilmiş rotalar listeleniyor ve                        │
 │    düzenlenebiliyor.                                               │
 │       - Bir rota düzenlenirken, sol paneldeki form                 │
 │    alanlarının yanı sıra sağdaki "Tur Planı" paneli de             │
 │    ilgili rotanın verileriyle güncelleniyor.                       │
 │       - Düzeltme: Rota oluşturulduktan sonra sayfayı               │
 │    yenileyince turların kaybolması sorunu giderildi.               │
 │    Rotalar artık allRoutes global değişkeninde tutuluyor           │
 │    ve loadInitialData() çağrısıyla başlangıçta yükleniyor.         │
 │       - Düzeltme: Rota güncellenirken alınan 500 Internal          │
 │    Server Error ve undefined değer hataları giderildi.             │
 │    totalKg ve notes alanlarının doğru şekilde gönderilmesi         │
 │    ve id değişkeninin kapsam sorunu çözüldü.                       │
 │    5. Tur Önizleme:                                                │
 │       - "Bugünkü Turlar" bölümündeki her rota için                 │
 │    "Önizle" butonu eklendi.                                        │
 │       - Bu butona tıklandığında, rotanın tur planı                 │
 │    detayları (marketler, paletler, notlar, toplamlar) bir          │
 │    modal pencerede gösteriliyor. Bu önizleme sadece tablo          │
 │    formatında olup, harita içermemektedir.                         │
 │    6. Genel UI/UX İyileştirmeleri:                                 │
 │       - Bootstrap 5 entegrasyonu ile modern ve duyarlı bir         │
 │    arayüz sağlandı.                                                │
 │       - 3 dikey ayarlanabilir panel (pane-controls,                │
 │    pane-map, pane-pallets) ile kullanıcıya esnek bir               │
 │    çalışma alanı sunuldu.                                          │
 │       - about-section'ın yerleşim sorunu giderilerek, rota         │
 │    oluşturma bölümüyle çakışması engellendi.                       │
 │       - Yeni: "Market Bul" butonu daha koyu mavi                   │
 │    (btn-primary) yapıldı.                                          │
 │       - Yeni: "Excel'den İçe Aktar" adında, turuncu                │
 │    (btn-warning) bir buton eklendi ve Excel yükleme alanı          │
 │    başlangıçta gizli hale getirildi, bu butonla açılıp             │
 │    kapanıyor.                                                      │
 │                                                                    │
 │    Yol Haritası ve Sonraki Adımlar (Önerilen):                     │
 │    - Market Özel Alanları Yönetimi: Şu anda backend'de             │
 │    tanımlı olan özel alanların frontend'e entegrasyonu ve          │
 │    market düzenleyici formunda dinamik olarak                      │
 │    gösterilmesi/düzenlenmesi.                                      │
 │    - Rota Detayları Harita Entegrasyonu: Tur önizleme              │
 │    modalına, rotanın harita üzerindeki                             │
 │    görselleştirilmesinin eklenmesi (şu an sadece tur planı         │
 │    tablosu gösteriliyor).                                          │
 │    - Gelişmiş Hata Yönetimi: Kullanıcıya daha anlaşılır            │
 │    hata mesajları sunulması ve hata loglama                        │
 │    mekanizmalarının daha da geliştirilmesi.                        │
 │    - Test Kapsamının Genişletilmesi: Yeni eklenen                  │
 │    özellikler için kapsamlı test senaryolarının                    │
 │    oluşturulması ve uygulanması."